{
    "sourceFile": "src/pages/api/advisors/addAdvisor.tsx",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 0,
            "patches": [
                {
                    "date": 1715486438861,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                }
            ],
            "date": 1715486438861,
            "name": "Commit-0",
            "content": "/*\n * @Author: huskydoge hbh001098hbh@sjtu.edu.cn\n * @Date: 2024-03-28 21:32:44\n * @LastEditors: huskydoge hbh001098hbh@sjtu.edu.cn\n * @LastEditTime: 2024-03-29 00:14:26\n * @FilePath: /connected-advisor/src/data/mongodb_client.tsx\n * @Description: 这是默认设置,请设置`customMade`, 打开koroFileHeader查看配置 进行设置: https://github.com/OBKoro1/koro1FileHeader/wiki/%E9%85%8D%E7%BD%AE\n */\n\n// pages/api/advisors/addAdvisor.tsx\n\nimport type { NextApiRequest, NextApiResponse } from \"next\";\nimport { MongoClient } from \"mongodb\";\n\n// MongoDB URL and database name\nconst MONGO_URL = process.env.MONGO_URL || \"\"; // Use the environment variable\nconst DB_NAME = \"ConnectedAdvisor\";\n\n// Function to connect to the database\nasync function connectToDatabase() {\n  const client = new MongoClient(MONGO_URL);\n  await client.connect();\n  return client.db(DB_NAME);\n}\n\n// API handler function\nexport default async function handler(\n  req: NextApiRequest,\n  res: NextApiResponse\n) {\n  console.log(\"Received request:\", req.method, req.body);\n  if (req.method === \"POST\") {\n    try {\n      const db = await connectToDatabase();\n      console.log(\"Database connected\");\n      const collection = db.collection(\"AdvisorTable\");\n      const result = await collection.insertOne(req.body);\n      console.log(\"Document inserted\", result);\n      res.status(200).json(result);\n    } catch (error) {\n      console.error(\"Error occurred:\", error);\n      res\n        .status(500)\n        .json({ error: \"Unable to connect to the database or insert data\" });\n    }\n  } else {\n    res.setHeader(\"Allow\", [\"POST\"]);\n    res.status(405).end(`Method ${req.method} Not Allowed`);\n  }\n}\n"
        }
    ]
}